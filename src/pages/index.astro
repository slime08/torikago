---
import Layout from '../layouts/Layout.astro';
---

<Layout
  title="Home"
  description="トリカゴ公式サイト。みどぺんと一緒に、作る・試す・公開する。YouTubeやXで活動中。"
>
  <div class="page-container" id="pageContainer">
    <!-- 歩くみどぺん（共通） -->
    <div class="walking-midopen" id="walkingMidopen">
      <video muted playsinline id="walkVideo">
        <source src="/midopen-walk.webm" type="video/webm" />
      </video>
    </div>

    <!-- ページ1: ヒーロー -->
    <section class="page-section is-active" data-page="0">
      <div class="page-content">
        <div class="hero">
          <div class="hero-image">
            <img src="/midopen-front.png" alt="みどぺん" />
          </div>
          <h1 class="hero-title">トリカゴ公式サイト</h1>
          <p class="hero-description">
            みどぺんと一緒に、作る・試す・公開する。
          </p>
        </div>
      </div>
      <div class="scroll-hint">↓ スクロールで次へ</div>
    </section>

    <!-- ページ2: 新着情報 -->
    <section class="page-section" data-page="1">
      <div class="page-content">
        <h2 class="section-title">新着情報</h2>
        <div class="card">
          <p class="card-description">
            公式サイトを公開しました。活動情報やガイドラインなどをこちらで発信していきます。
          </p>
        </div>
      </div>
    </section>

    <!-- ページ3: コンテンツ -->
    <section class="page-section" data-page="2">
      <div class="page-content">
        <h2 class="section-title">コンテンツ</h2>
        <div class="card-grid">
          <a href="/about" class="card">
            <h3 class="card-title">About</h3>
            <p class="card-description">トリカゴについて紹介します。</p>
          </a>
          <a href="/character" class="card">
            <h3 class="card-title">Character</h3>
            <p class="card-description">みどぺんの紹介とガイドライン。</p>
          </a>
          <a href="/works" class="card">
            <h3 class="card-title">Works</h3>
            <p class="card-description">制作物の一覧を見る。</p>
          </a>
          <a href="/guidelines" class="card">
            <h3 class="card-title">Guidelines</h3>
            <p class="card-description">素材利用の方針。</p>
          </a>
        </div>
      </div>
    </section>

    <!-- ページ4: リンク -->
    <section class="page-section" data-page="3">
      <div class="page-content">
        <h2 class="section-title">リンク</h2>
        <div class="contact-links">
          <a href="https://www.youtube.com/@%E3%83%88%E3%83%AA%E3%82%AB%E3%82%B4-oAo" class="btn" target="_blank" rel="noopener noreferrer">
            YouTube
          </a>
          <a href="https://x.com/TorikagoNoAka" class="btn btn-outline" target="_blank" rel="noopener noreferrer">
            X (Twitter)
          </a>
        </div>
      </div>
      <div class="scroll-hint scroll-hint-up">↑ スクロールで戻る</div>
    </section>

    <!-- ページインジケーター -->
    <div class="page-indicator">
      <span class="dot is-active" data-goto="0"></span>
      <span class="dot" data-goto="1"></span>
      <span class="dot" data-goto="2"></span>
      <span class="dot" data-goto="3"></span>
    </div>
  </div>
</Layout>

<style>
  .page-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  .page-section {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: var(--spacing-lg);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .page-section.is-active {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }

  .page-section.slide-out-left {
    opacity: 0;
    transform: translateX(-100%);
  }

  .page-section.slide-out-right {
    opacity: 0;
    transform: translateX(100%);
  }

  .page-section.slide-in-left {
    transform: translateX(-100%);
  }

  .page-section.slide-in-right {
    transform: translateX(100%);
  }

  .page-content {
    max-width: var(--max-width);
    width: 100%;
    text-align: center;
  }

  /* 歩くみどぺん */
  .walking-midopen {
    position: fixed;
    bottom: 50px;
    left: -300px;
    height: 150px;
    z-index: 100;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .walking-midopen.is-visible {
    opacity: 1;
  }

  .walking-midopen.walk-right {
    animation: walkRight 4s ease-in-out forwards;
  }

  .walking-midopen.walk-left {
    animation: walkLeft 4s ease-in-out forwards;
    transform: scaleX(-1);
  }

  .walking-midopen video {
    height: 150px;
    width: auto;
  }

  @keyframes walkRight {
    0% { left: -300px; }
    100% { left: calc(100% + 100px); }
  }

  @keyframes walkLeft {
    0% { left: calc(100% + 100px); }
    100% { left: -300px; }
  }

  /* ヒーロー */
  .hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-md);
  }

  .hero-image {
    width: 280px;
    height: 280px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hero-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 8px 24px rgba(45, 106, 79, 0.2));
  }

  .hero-title {
    font-size: 2.5rem;
    color: var(--color-primary-dark);
  }

  .hero-description {
    font-size: 1.25rem;
    color: var(--color-text-muted);
  }

  /* スクロールヒント */
  .scroll-hint {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    color: var(--color-text-muted);
    font-size: 0.875rem;
    animation: bounce 2s infinite;
  }

  .scroll-hint-up {
    animation: bounceUp 2s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(8px); }
  }

  @keyframes bounceUp {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-8px); }
  }

  /* ページインジケーター */
  .page-indicator {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 50;
  }

  .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--color-border);
    cursor: pointer;
    transition: background 0.3s, transform 0.3s;
  }

  .dot:hover {
    transform: scale(1.2);
  }

  .dot.is-active {
    background: var(--color-primary);
  }

  /* カード類 */
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    text-align: left;
  }

  .contact-links {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .hero-image {
      width: 200px;
      height: 200px;
    }

    .hero-title {
      font-size: 1.75rem;
    }

    .hero-description {
      font-size: 1rem;
    }

    .walking-midopen {
      height: 100px;
      bottom: 30px;
    }

    .walking-midopen video {
      height: 100px;
    }

    .page-indicator {
      right: 10px;
    }

    .dot {
      width: 10px;
      height: 10px;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var container = document.getElementById('pageContainer');
    var sections = document.querySelectorAll('.page-section');
    var dots = document.querySelectorAll('.dot');
    var walker = document.getElementById('walkingMidopen');
    var video = document.getElementById('walkVideo');

    var currentPage = 0;
    var totalPages = sections.length;
    var isAnimating = false;
    var scrollAccumulator = 0;
    var scrollThreshold = 100;

    function goToPage(targetPage, direction) {
      if (isAnimating || targetPage === currentPage || targetPage < 0 || targetPage >= totalPages) {
        return;
      }

      isAnimating = true;
      var currentSection = sections[currentPage];
      var targetSection = sections[targetPage];

      // みどぺんを表示して歩かせる
      walker.classList.remove('walk-right', 'walk-left');
      walker.classList.add('is-visible');

      if (direction === 'next') {
        walker.style.transform = 'scaleX(1)';
        walker.classList.add('walk-right');
        currentSection.classList.add('slide-out-left');
        targetSection.classList.add('slide-in-right');
      } else {
        walker.style.transform = 'scaleX(-1)';
        walker.classList.add('walk-left');
        currentSection.classList.add('slide-out-right');
        targetSection.classList.add('slide-in-left');
      }

      video.currentTime = 0;
      video.play();

      // 2秒後にページ切り替え開始
      setTimeout(function() {
        targetSection.classList.remove('slide-in-left', 'slide-in-right');
        targetSection.classList.add('is-active');
        currentSection.classList.remove('is-active');

        // ドット更新
        dots[currentPage].classList.remove('is-active');
        dots[targetPage].classList.add('is-active');

        currentPage = targetPage;
      }, 2000);

      // 4秒後にアニメーション完了
      setTimeout(function() {
        currentSection.classList.remove('slide-out-left', 'slide-out-right');
        walker.classList.remove('is-visible', 'walk-right', 'walk-left');
        isAnimating = false;
        scrollAccumulator = 0;
      }, 4000);
    }

    // ホイールイベント
    container.addEventListener('wheel', function(e) {
      e.preventDefault();

      if (isAnimating) return;

      scrollAccumulator += e.deltaY;

      if (scrollAccumulator > scrollThreshold) {
        // 下スクロール → 次のページ
        goToPage(currentPage + 1, 'next');
      } else if (scrollAccumulator < -scrollThreshold) {
        // 上スクロール → 前のページ
        goToPage(currentPage - 1, 'prev');
      }
    }, { passive: false });

    // タッチイベント
    var touchStartY = 0;
    container.addEventListener('touchstart', function(e) {
      touchStartY = e.touches[0].clientY;
    }, { passive: true });

    container.addEventListener('touchend', function(e) {
      if (isAnimating) return;

      var touchEndY = e.changedTouches[0].clientY;
      var diff = touchStartY - touchEndY;

      if (diff > 50) {
        // 上にスワイプ → 次のページ
        goToPage(currentPage + 1, 'next');
      } else if (diff < -50) {
        // 下にスワイプ → 前のページ
        goToPage(currentPage - 1, 'prev');
      }
    }, { passive: true });

    // ドットクリック
    dots.forEach(function(dot) {
      dot.addEventListener('click', function() {
        var target = parseInt(this.getAttribute('data-goto'));
        var direction = target > currentPage ? 'next' : 'prev';
        goToPage(target, direction);
      });
    });

    // キーボード操作
    document.addEventListener('keydown', function(e) {
      if (isAnimating) return;

      if (e.key === 'ArrowDown' || e.key === 'PageDown') {
        e.preventDefault();
        goToPage(currentPage + 1, 'next');
      } else if (e.key === 'ArrowUp' || e.key === 'PageUp') {
        e.preventDefault();
        goToPage(currentPage - 1, 'prev');
      }
    });
  });
</script>
