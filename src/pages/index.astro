---
import Layout from '../layouts/Layout.astro';
---

<Layout
  title="Home"
  description="トリカゴ公式サイト。みどぺんと一緒に、作る・試す・公開する。YouTubeやXで活動中。"
>
  <div class="page-container">
    <!-- ページ1: ヒーロー -->
    <section class="page-section is-active" id="page-hero">
      <div class="page-content">
        <div class="hero">
          <div class="hero-image">
            <img src="/midopen-front.png" alt="みどぺん" />
          </div>
          <h1 class="hero-title">トリカゴ公式サイト</h1>
          <p class="hero-description">
            みどぺんと一緒に、作る・試す・公開する。
          </p>
        </div>
      </div>
      <div class="page-transition" data-next="page-news">
        <div class="transition-walker">
          <video muted playsinline>
            <source src="/midopen-walk.webm" type="video/webm" />
          </video>
        </div>
        <div class="scroll-hint">↓ スクロール</div>
      </div>
    </section>

    <!-- ページ2: 新着情報 -->
    <section class="page-section" id="page-news">
      <div class="page-content">
        <h2 class="section-title">新着情報</h2>
        <div class="card">
          <p class="card-description">
            公式サイトを公開しました。活動情報やガイドラインなどをこちらで発信していきます。
          </p>
        </div>
      </div>
      <div class="page-transition" data-next="page-contents">
        <div class="transition-walker">
          <video muted playsinline>
            <source src="/midopen-walk.webm" type="video/webm" />
          </video>
        </div>
      </div>
    </section>

    <!-- ページ3: コンテンツ -->
    <section class="page-section" id="page-contents">
      <div class="page-content">
        <h2 class="section-title">コンテンツ</h2>
        <div class="card-grid">
          <a href="/about" class="card">
            <h3 class="card-title">About</h3>
            <p class="card-description">トリカゴについて紹介します。</p>
          </a>
          <a href="/character" class="card">
            <h3 class="card-title">Character</h3>
            <p class="card-description">みどぺんの紹介とガイドライン。</p>
          </a>
          <a href="/works" class="card">
            <h3 class="card-title">Works</h3>
            <p class="card-description">制作物の一覧を見る。</p>
          </a>
          <a href="/guidelines" class="card">
            <h3 class="card-title">Guidelines</h3>
            <p class="card-description">素材利用の方針。</p>
          </a>
        </div>
      </div>
      <div class="page-transition" data-next="page-links">
        <div class="transition-walker">
          <video muted playsinline>
            <source src="/midopen-walk.webm" type="video/webm" />
          </video>
        </div>
      </div>
    </section>

    <!-- ページ4: リンク -->
    <section class="page-section" id="page-links">
      <div class="page-content">
        <h2 class="section-title">リンク</h2>
        <div class="contact-links">
          <a href="https://www.youtube.com/@%E3%83%88%E3%83%AA%E3%82%AB%E3%82%B4-oAo" class="btn" target="_blank" rel="noopener noreferrer">
            YouTube
          </a>
          <a href="https://x.com/TorikagoNoAka" class="btn btn-outline" target="_blank" rel="noopener noreferrer">
            X (Twitter)
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  .page-container {
    position: relative;
    overflow: hidden;
  }

  .page-section {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: var(--spacing-lg);
    position: relative;
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .page-section.is-active {
    opacity: 1;
    transform: translateX(0);
  }

  .page-section.is-exiting {
    opacity: 0;
    transform: translateX(-100%);
  }

  .page-content {
    max-width: var(--max-width);
    width: 100%;
    text-align: center;
  }

  /* ヒーロー */
  .hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-md);
  }

  .hero-image {
    width: 280px;
    height: 280px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hero-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 8px 24px rgba(45, 106, 79, 0.2));
  }

  .hero-title {
    font-size: 2.5rem;
    color: var(--color-primary-dark);
  }

  .hero-description {
    font-size: 1.25rem;
    color: var(--color-text-muted);
  }

  /* トランジション領域 */
  .page-transition {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 150px;
    overflow: hidden;
  }

  .transition-walker {
    position: absolute;
    left: -300px;
    bottom: 20px;
    height: 130px;
    opacity: 0;
    z-index: 10;
  }

  .transition-walker.is-walking {
    opacity: 1;
    animation: walkAcross 5s ease-in-out forwards;
  }

  .transition-walker video {
    height: 130px;
    width: auto;
  }

  @keyframes walkAcross {
    0% {
      left: -300px;
    }
    100% {
      left: calc(100% + 100px);
    }
  }

  .scroll-hint {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: var(--color-text-muted);
    font-size: 0.875rem;
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(8px); }
  }

  /* カード類 */
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    text-align: left;
  }

  .contact-links {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .hero-image {
      width: 200px;
      height: 200px;
    }

    .hero-title {
      font-size: 1.75rem;
    }

    .hero-description {
      font-size: 1rem;
    }

    .transition-walker {
      height: 90px;
    }

    .transition-walker video {
      height: 90px;
    }

    .page-section {
      min-height: auto;
      padding: var(--spacing-xl) var(--spacing-sm);
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var sections = document.querySelectorAll('.page-section');
    var transitions = document.querySelectorAll('.page-transition');
    var isAnimating = false;

    // 最初のセクション以外を非表示に
    sections.forEach(function(section, index) {
      if (index > 0) {
        section.style.display = 'none';
      }
    });

    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting && !isAnimating) {
          var transition = entry.target;
          var walker = transition.querySelector('.transition-walker');
          var video = walker ? walker.querySelector('video') : null;
          var nextSectionId = transition.getAttribute('data-next');
          var nextSection = nextSectionId ? document.getElementById(nextSectionId) : null;
          var currentSection = transition.closest('.page-section');

          if (walker && !walker.classList.contains('is-walking') && nextSection) {
            isAnimating = true;

            // スクロールヒントを非表示
            var hint = transition.querySelector('.scroll-hint');
            if (hint) hint.style.display = 'none';

            // みどぺんが歩き始める
            walker.classList.add('is-walking');
            if (video) video.play();

            // 2.5秒後（みどぺんが中央を通過する頃）に次のセクションを表示開始
            setTimeout(function() {
              nextSection.style.display = 'flex';
              // 少し待ってからアニメーション開始
              requestAnimationFrame(function() {
                currentSection.classList.add('is-exiting');
                currentSection.classList.remove('is-active');
                nextSection.classList.add('is-active');
              });
            }, 2500);

            // アニメーション完了後
            setTimeout(function() {
              currentSection.style.display = 'none';
              currentSection.classList.remove('is-exiting');
              isAnimating = false;
            }, 5500);

            observer.unobserve(transition);
          }
        }
      });
    }, {
      threshold: 0.8
    });

    transitions.forEach(function(transition) {
      observer.observe(transition);
    });
  });
</script>
