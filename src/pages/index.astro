---
import Layout from '../layouts/Layout.astro';
---

<Layout
  title="Home"
  description="トリカゴ公式サイト。みどぺんと一緒に、作る・試す・公開する。YouTubeやXで活動中。"
>
  <section class="hero">
    <div class="hero-image">
      <img src="/midopen-hero.png" alt="みどぺん" width="200" height="200" />
    </div>
    <h1 class="hero-title">トリカゴ公式サイト</h1>
    <p class="hero-description">
      みどぺんと一緒に、作る・試す・公開する。
    </p>
  </section>

  <!-- トランジション1 -->
  <div class="transition-trigger" data-next="section-news">
    <div class="transition-walker">
      <video muted playsinline>
        <source src="/midopen-walk.webm" type="video/webm" />
      </video>
    </div>
  </div>

  <section class="section fade-section" id="section-news">
    <h2 class="section-title">新着情報</h2>
    <div class="card">
      <p class="card-description">
        公式サイトを公開しました。活動情報やガイドラインなどをこちらで発信していきます。
      </p>
    </div>
  </section>

  <!-- トランジション2 -->
  <div class="transition-trigger" data-next="section-contents">
    <div class="transition-walker">
      <video muted playsinline>
        <source src="/midopen-walk.webm" type="video/webm" />
      </video>
    </div>
  </div>

  <section class="section fade-section" id="section-contents">
    <h2 class="section-title">コンテンツ</h2>
    <div class="card-grid">
      <a href="/about" class="card">
        <h3 class="card-title">About</h3>
        <p class="card-description">トリカゴについて紹介します。</p>
      </a>
      <a href="/character" class="card">
        <h3 class="card-title">Character</h3>
        <p class="card-description">みどぺんの紹介とガイドライン。</p>
      </a>
      <a href="/works" class="card">
        <h3 class="card-title">Works</h3>
        <p class="card-description">制作物の一覧を見る。</p>
      </a>
      <a href="/guidelines" class="card">
        <h3 class="card-title">Guidelines</h3>
        <p class="card-description">素材利用の方針。</p>
      </a>
    </div>
  </section>

  <!-- トランジション3 -->
  <div class="transition-trigger" data-next="section-links">
    <div class="transition-walker">
      <video muted playsinline>
        <source src="/midopen-walk.webm" type="video/webm" />
      </video>
    </div>
  </div>

  <section class="section fade-section" id="section-links">
    <h2 class="section-title">リンク</h2>
    <div class="contact-links">
      <a href="https://www.youtube.com/@%E3%83%88%E3%83%AA%E3%82%AB%E3%82%B4-oAo" class="btn" target="_blank" rel="noopener noreferrer">
        YouTube
      </a>
      <a href="https://x.com/TorikagoNoAka" class="btn btn-outline" target="_blank" rel="noopener noreferrer">
        X (Twitter)
      </a>
    </div>
  </section>
</Layout>

<style>
  .transition-trigger {
    position: relative;
    width: 100%;
    height: 120px;
    overflow: hidden;
    margin: var(--spacing-md) 0;
  }

  .transition-walker {
    position: absolute;
    left: -250px;
    bottom: 0;
    height: 120px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .transition-walker.is-walking {
    opacity: 1;
    animation: walkOnce 2s ease-in-out forwards;
  }

  .transition-walker video {
    height: 120px;
    width: auto;
  }

  @keyframes walkOnce {
    0% {
      left: -250px;
    }
    100% {
      left: calc(100% + 50px);
    }
  }

  /* 次のセクション：最初は非表示 */
  .fade-section {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .fade-section.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 768px) {
    .transition-trigger {
      height: 80px;
    }
    .transition-walker {
      height: 80px;
    }
    .transition-walker video {
      height: 80px;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var triggers = document.querySelectorAll('.transition-trigger');

    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var trigger = entry.target;
          var walker = trigger.querySelector('.transition-walker');
          var video = walker ? walker.querySelector('video') : null;
          var nextSectionId = trigger.getAttribute('data-next');
          var nextSection = nextSectionId ? document.getElementById(nextSectionId) : null;

          if (walker && !walker.classList.contains('is-walking')) {
            walker.classList.add('is-walking');
            if (video) video.play();

            setTimeout(function() {
              if (nextSection) nextSection.classList.add('is-visible');
            }, 1200);
          }

          observer.unobserve(trigger);
        }
      });
    }, {
      threshold: 0.5
    });

    triggers.forEach(function(trigger) {
      observer.observe(trigger);
    });
  });
</script>
